# OCPP Charging Station Management System

A comprehensive, production-ready EV charging station management system implementing OCPP 1.6 protocol with modern web technologies. This system provides real-time monitoring, control, and management of electric vehicle charging infrastructure with role-based access control and integrated financial management.

## üèóÔ∏è Architecture Overview

### System Components

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        OCPP CSMS Architecture                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                        ‚îÇ                                       ‚îÇ
‚îÇ      Frontend          ‚îÇ             Backend                   ‚îÇ
‚îÇ    (Next.js 15)        ‚îÇ           (FastAPI)                   ‚îÇ
‚îÇ                        ‚îÇ                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Web Dashboard  ‚îÇ‚óÑ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚ñ∫‚îÇ     REST API Server             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ   ‚îÇ   ‚îÇ                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Admin UI      ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ Station Management            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ User UI       ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ Charger Control               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Interactive   ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ Transaction Tracking          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   Maps          ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ User Management               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ QR Scanner    ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ Wallet Operations             ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                        ‚îÇ              ‚îÇ                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Clerk Auth    ‚îÇ‚óÑ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚ñ∫‚îÇ    OCPP WebSocket Server        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ   ‚îÇ   ‚îÇ                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ JWT Tokens    ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ OCPP 1.6 Protocol            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ RBAC          ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ Real-time Communication       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ User Sessions ‚îÇ   ‚îÇ   ‚îÇ ‚Ä¢ Connection Management         ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                        ‚îÇ              ‚îÇ                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ              ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ              Database Layer             ‚îÇ
           ‚îÇ                                         ‚îÇ
           ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
           ‚îÇ  ‚îÇ PostgreSQL  ‚îÇ    ‚îÇ     Redis       ‚îÇ  ‚îÇ
           ‚îÇ  ‚îÇ             ‚îÇ    ‚îÇ                 ‚îÇ  ‚îÇ
           ‚îÇ  ‚îÇ ‚Ä¢ Stations  ‚îÇ    ‚îÇ ‚Ä¢ Connections   ‚îÇ  ‚îÇ
           ‚îÇ  ‚îÇ ‚Ä¢ Chargers  ‚îÇ    ‚îÇ ‚Ä¢ Sessions      ‚îÇ  ‚îÇ
           ‚îÇ  ‚îÇ ‚Ä¢ Txns      ‚îÇ    ‚îÇ ‚Ä¢ Real-time     ‚îÇ  ‚îÇ
           ‚îÇ  ‚îÇ ‚Ä¢ Users     ‚îÇ    ‚îÇ   State         ‚îÇ  ‚îÇ
           ‚îÇ  ‚îÇ ‚Ä¢ Wallets   ‚îÇ    ‚îÇ ‚Ä¢ Cache         ‚îÇ  ‚îÇ
           ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ            OCPP Charge Points           ‚îÇ
           ‚îÇ                                         ‚îÇ
           ‚îÇ  üì±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  üì±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  üì±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  üì±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚îÇ
           ‚îÇ  ‚îÇ CP-1‚îÇ  ‚îÇ CP-2‚îÇ  ‚îÇ CP-3‚îÇ  ‚îÇ CP-N‚îÇ     ‚îÇ
           ‚îÇ  ‚îÇ     ‚îÇ  ‚îÇ     ‚îÇ  ‚îÇ     ‚îÇ  ‚îÇ     ‚îÇ     ‚îÇ
           ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üõ†Ô∏è Technology Stack

### Backend (Python FastAPI)
- **Framework**: FastAPI with Uvicorn ASGI server
- **Database**: PostgreSQL with Tortoise ORM (async)
- **Cache**: Redis for connection state management
- **Authentication**: Clerk JWT validation with role-based access
- **Protocol**: OCPP 1.6 WebSocket implementation
- **API**: RESTful APIs with OpenAPI documentation
- **Deployment**: Production-ready on Render

### Frontend (Next.js)
- **Framework**: Next.js 15 with App Router and React 19
- **Language**: TypeScript for type safety
- **Styling**: Tailwind CSS v4 with Shadcn/ui components
- **State Management**: TanStack Query for server state
- **Authentication**: Clerk client-side auth with RBAC
- **Maps**: React Leaflet for interactive station maps
- **QR Scanning**: ZXing library for charger access
- **Deployment**: Vercel with automatic deployments

### Infrastructure
- **Authentication**: Clerk for user management and JWT
- **Database**: PostgreSQL with SSL (Tortoise ORM + AsyncPG)
- **Cache**: Redis for real-time state
- **Hosting**: Render (backend) + Vercel (frontend)

## üöÄ Development Setup

### Prerequisites
- Node.js 18+ (for frontend)
- Python 3.9+ (for backend)
- PostgreSQL database
- Redis instance
- Clerk account for authentication

### Backend Setup

```bash
cd backend

# Install dependencies
pip install -r requirements.txt

# Environment configuration
# Set the following environment variables:
export DATABASE_URL="postgresql://user:password@localhost:5432/ocpp_db"
export REDIS_URL="redis://localhost:6379"
export CLERK_SECRET_KEY="your-clerk-secret-key"
export CLERK_JWT_VERIFICATION_KEY="your-clerk-jwt-key"
export CLERK_WEBHOOK_SECRET="your-clerk-webhook-secret"
export ENVIRONMENT="development"

# Database migrations
aerich upgrade

# Start development server
python main.py
```

### Frontend Setup

```bash
cd frontend

# Install dependencies
npm install

# Environment configuration
# Create .env.local with:
echo "NEXT_PUBLIC_API_URL=http://localhost:8000" >> .env.local
echo "NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your-clerk-publishable-key" >> .env.local
echo "CLERK_SECRET_KEY=your-clerk-secret-key" >> .env.local

# Start development server
npm run dev
```

### Environment Variables

**Backend (.env)**:
```bash
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/ocpp_db

# Redis
REDIS_URL=redis://localhost:6379

# Clerk Authentication
CLERK_SECRET_KEY=sk_test_...
CLERK_JWT_VERIFICATION_KEY=...
CLERK_WEBHOOK_SECRET=whsec_...

# Application
ENVIRONMENT=development
PORT=8000
```

**Frontend (.env.local)**:
```bash
# API
NEXT_PUBLIC_API_URL=http://localhost:8000

# Clerk Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
```

## üì± Features

### Role-Based Access Control
- **USER Role**: Station finder, QR scanner, personal charging history
- **ADMIN Role**: Full system management, charger control, user administration

### Dashboard Features
- **Real-time Monitoring**: Live charger status and connection monitoring
- **Station Management**: Create and manage charging station locations with maps
- **Charger Control**: Remote start/stop and availability control via OCPP
- **Transaction Tracking**: Complete charging session history with energy analytics
- **User Management**: Admin panel for user administration and wallet management
- **Interactive Maps**: React Leaflet integration for station discovery
- **QR Code Scanning**: Quick charger access via mobile scanning

### OCPP 1.6 Features
- **Full OCPP 1.6 Compliance**: All core messages and remote commands
- **Real-time Communication**: WebSocket-based charge point communication
- **Message Logging**: Complete audit trail of OCPP messages with correlation IDs
- **Connection Management**: Automatic heartbeat monitoring and cleanup
- **Transaction Management**: Complete lifecycle from start to billing
- **Meter Values**: Real-time energy measurement collection

### Financial Integration
- **Wallet System**: User balance management with automatic billing
- **Transaction Billing**: Energy-based charging with automated processing
- **Billing Retry Service**: Automatic recovery for failed transactions
- **Payment Integration**: Ready for payment gateway integration

## üèóÔ∏è API Documentation

### OCPP WebSocket Endpoint
- **Endpoint**: `ws://localhost:8000/ocpp/{charge_point_id}`
- **Authentication**: Database validation of charge point registration
- **Supported Messages**: BootNotification, Heartbeat, StatusNotification, StartTransaction, StopTransaction, MeterValues
- **Remote Commands**: RemoteStartTransaction, RemoteStopTransaction, ChangeAvailability

### REST API Endpoints

**Admin Management** (`/api/admin/` - Requires ADMIN role):
```
# Stations
GET    /api/admin/stations              # List stations with charger count
POST   /api/admin/stations              # Create new station
GET    /api/admin/stations/{id}         # Get station details
PUT    /api/admin/stations/{id}         # Update station
DELETE /api/admin/stations/{id}         # Delete station

# Chargers  
GET    /api/admin/chargers              # List chargers with real-time status
POST   /api/admin/chargers              # Create new charger
GET    /api/admin/chargers/{id}         # Get charger details
PUT    /api/admin/chargers/{id}         # Update charger
DELETE /api/admin/chargers/{id}         # Delete charger
POST   /api/admin/chargers/{id}/remote-start      # Remote start charging
POST   /api/admin/chargers/{id}/remote-stop       # Remote stop charging
POST   /api/admin/chargers/{id}/change-availability # Change charger availability

# Transactions
GET    /api/admin/transactions          # List transactions with analytics
GET    /api/admin/transactions/{id}     # Get transaction details
GET    /api/admin/transactions/{id}/meter-values # Get meter readings
```

**User Management**:
```
GET    /auth/profile                    # Current user profile
GET    /users                           # List users (admin) or current user
GET    /users/{id}                      # User details with wallet info
GET    /users/{id}/transactions         # User transaction history
```

**Legacy APIs** (Backward Compatibility):
```
GET    /api/charge-points               # List connected charge points
POST   /api/charge-points/{id}/request  # Send OCPP command
GET    /api/logs                        # OCPP message logs
```

### API Documentation
- **Interactive Docs**: Available at `http://localhost:8000/docs`
- **OpenAPI Schema**: Available at `http://localhost:8000/openapi.json`

## üîß Deployment

### Backend Deployment (Render)
```yaml
# Service Configuration
services:
  - type: web
    name: ocpp-backend
    env: python
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python main.py"
    plan: standard
    healthCheckPath: "/"
```

**Environment Variables**: Set DATABASE_URL, REDIS_URL, CLERK_* variables

### Frontend Deployment (Vercel)
- **Framework**: Next.js with automatic optimization
- **Environment Variables**: Set NEXT_PUBLIC_API_URL, NEXT_PUBLIC_CLERK_* variables

## üß™ Testing

### Backend Testing
```bash
cd backend

# Run all tests
pytest

# Run by category
pytest -m unit          # Fast unit tests (~1 second)
pytest -m integration   # Full OCPP WebSocket tests (~45 seconds)
pytest -m infrastructure # Database/Redis tests (~5 seconds)

# Run with coverage
pytest --cov=. --cov-report=html
```

### OCPP Testing
```bash
# Test complete charging session
python simulators/ocpp_simulator_full_success.py

# Test availability changes
python simulators/ocpp_simulator_change_availability.py

# Test WebSocket connection
websocat ws://localhost:8000/ocpp/CP001
```

## üìä Project Structure

### Backend Structure
```
backend/
‚îú‚îÄ‚îÄ main.py                 # FastAPI app with OCPP WebSocket endpoint
‚îú‚îÄ‚îÄ models.py              # Tortoise ORM models with OCPP enums
‚îú‚îÄ‚îÄ auth_middleware.py     # Clerk JWT authentication
‚îú‚îÄ‚îÄ redis_manager.py       # Redis connection management
‚îú‚îÄ‚îÄ tortoise_config.py     # Database configuration
‚îú‚îÄ‚îÄ routers/               # API route modules
‚îÇ   ‚îú‚îÄ‚îÄ stations.py        # Station management
‚îÇ   ‚îú‚îÄ‚îÄ chargers.py        # Charger management with OCPP commands
‚îÇ   ‚îú‚îÄ‚îÄ transactions.py    # Transaction tracking
‚îÇ   ‚îú‚îÄ‚îÄ users.py           # User management
‚îÇ   ‚îî‚îÄ‚îÄ webhooks.py        # Clerk webhook handling
‚îú‚îÄ‚îÄ services/              # Business logic
‚îÇ   ‚îú‚îÄ‚îÄ wallet_service.py  # Billing and payments
‚îÇ   ‚îî‚îÄ‚îÄ billing_retry_service.py # Failed transaction recovery
‚îú‚îÄ‚îÄ tests/                 # Comprehensive test suite
‚îú‚îÄ‚îÄ simulators/            # OCPP charger simulators
‚îî‚îÄ‚îÄ migrations/            # Database migrations
```

### Frontend Structure
```
frontend/
‚îú‚îÄ‚îÄ app/                   # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx         # Root layout with providers
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # Role-based dashboard
‚îÇ   ‚îú‚îÄ‚îÄ auth/              # Authentication pages
‚îÇ   ‚îú‚îÄ‚îÄ admin/             # Admin-only management interface
‚îÇ   ‚îú‚îÄ‚îÄ stations/          # Station finder with maps
‚îÇ   ‚îú‚îÄ‚îÄ scanner/           # QR code scanning
‚îÇ   ‚îî‚îÄ‚îÄ charge/            # Individual charger interface
‚îú‚îÄ‚îÄ components/            # React components
‚îÇ   ‚îú‚îÄ‚îÄ ui/               # Shadcn/ui components
‚îÇ   ‚îú‚îÄ‚îÄ Navbar.tsx        # Role-based navigation
‚îÇ   ‚îú‚îÄ‚îÄ RoleWrapper.tsx   # RBAC components
‚îÇ   ‚îî‚îÄ‚îÄ QRScanner.tsx     # QR code scanning
‚îú‚îÄ‚îÄ contexts/             # React context providers
‚îú‚îÄ‚îÄ lib/                  # API integration and utilities
‚îÇ   ‚îú‚îÄ‚îÄ api-client.ts     # HTTP client with Clerk auth
‚îÇ   ‚îú‚îÄ‚îÄ api-services.ts   # Domain-specific API services
‚îÇ   ‚îî‚îÄ‚îÄ queries/          # TanStack Query hooks
‚îî‚îÄ‚îÄ types/                # TypeScript definitions
```

## üîê Security Features
- **JWT Authentication**: Clerk-powered token validation with role-based access
- **RBAC**: Comprehensive role separation (ADMIN vs USER)
- **Protected Routes**: Automatic authentication guards
- **CORS Protection**: Configured for secure cross-origin requests
- **Input Validation**: Pydantic schema validation for all API inputs
- **OCPP Security**: Charger registration validation before WebSocket connection
- **Audit Trail**: Complete OCPP message logging for compliance

## üìà Performance & Scalability
- **Async Architecture**: Full async/await pattern throughout backend
- **Redis Caching**: Real-time connection state with O(1) lookups
- **Database Optimization**: Connection pooling and optimized queries
- **Frontend Optimization**: TanStack Query with intelligent caching
- **Bundle Optimization**: Code splitting and lazy loading
- **CDN Deployment**: Global edge deployment via Vercel

## üõ†Ô∏è Known Issues & Technical Debt

### Critical Issue: Boot Notification Transaction Handling
**Location**: `backend/main.py:69-94`
**Issue**: Currently fails ongoing transactions immediately on charger reboot
**Impact**: Users lose active charging sessions unnecessarily
**Solution**: Implement transaction reconciliation with PENDING_RECONCILIATION status

### Performance Improvements
- Database query optimization for N+1 patterns
- Frontend bundle size reduction through code splitting
- Enhanced Redis connection pooling

### Security Enhancements
- OCPP message schema validation
- API rate limiting implementation
- Enhanced audit logging

## üöÄ Future Roadmap

### Short-term (Next 3 months)
- Fix boot notification transaction handling
- Enhanced OCPP command support (Reset, GetConfiguration, UnlockConnector)
- Performance optimizations and query improvements
- Rate limiting and enhanced security

### Medium-term (3-6 months)
- Advanced analytics and reporting dashboard
- Push notifications and offline PWA features
- Multi-tenant architecture support
- Predictive maintenance features

### Long-term (6+ months)
- OCPP 2.0.1 migration path
- Smart grid integration capabilities
- Machine learning for demand forecasting
- Advanced payment systems and roaming support

## üìú License

This project is licensed under the MIT License.

## üÜò Support & Documentation

### Additional Resources
- **Architecture Documentation**: `docs/v1/comprehensive-architecture-documentation.md`
- **LLM Context**: `docs/v1/llm-context-document.md`
- **OCPP 1.6 Specification**: Available in `docs/v1/` directory
- **API Documentation**: Available at `/docs` endpoint when running

### Development Commands
```bash
# Backend
cd backend
python main.py                    # Start server
aerich migrate --name "desc"      # Create migration
aerich upgrade                    # Apply migrations
pytest                           # Run tests

# Frontend  
cd frontend
npm run dev                      # Start development
npm run build                    # Build for production
npm run lint                     # Lint code
```

---

**Built with ‚ù§Ô∏è for the EV charging ecosystem**

**Current Status**: Production-ready system actively managing real-world charging infrastructure
**Version**: 2.0  
**Last Updated**: January 2025